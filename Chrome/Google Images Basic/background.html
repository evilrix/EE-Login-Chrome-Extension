<html>
<head>
  <script>
	var reGib = /(?!.+sout=1)^http:\/\/www\.google\.[^\/]+\/images/;
	
	function handle(tab)
	{
		chrome.tabs.update(tab.id, {'url': tab.url + '&sout=1'});
	}
	
    chrome.pageAction.onClicked.addListener(function(tab) {
		handle(tab)
    });
	
    chrome.tabs.onUpdated.addListener( function (tabId, changeInfo, tab) {
		if(changeInfo.status == "loading" && reGib.test(tab.url))
		{			
			if(localStorage["automatic"] == "true")
			{
				handle(tab)
			}
			else
			{
				chrome.pageAction.show(tab.id);
			}
		}
    });
  </script>
  </head>
</html>

